 TECHNOLOGIES Ã€ UTILISER

Langage : Swift
Framework AR : ARKit
Interface : SwiftUI ou UIKit (au choix)
Scan QR Code : AVFoundation + Vision
Stockage : Pas de persistance (donnÃ©es perdues Ã  la fermeture)


ğŸ“‹ FONCTIONNALITÃ‰S DÃ‰TAILLÃ‰ES
1. Scanner QR Code au dÃ©marrage
Comportement :

Ouvrir la camÃ©ra pour scanner un QR Code
Le QR Code contient :

json{
  "id": "123",
  "nom": "Plantation-aka",
  "lat": 6.5,
  "lon": -3.4
}
```
- Valider le format JSON (vÃ©rifier prÃ©sence de `id`, `nom`, `lat`, `lon`)
- Si invalide â†’ afficher erreur et permettre de rescanner
- Si valide â†’ passer Ã  l'Ã©cran AR

**Note :** Les coordonnÃ©es GPS ne sont utilisÃ©es QUE pour l'information, pas pour la localisation.

---

### 2. Ã‰cran AR avec mesure en temps rÃ©el

**Interface :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ RÃ©f: Plantation-aka         â”‚  â† HUD overlay
â”‚  ğŸ“ Distance: 3.24 m            â”‚
â”‚  ğŸ¯ Surfaces: 3                 â”‚
â”‚  ğŸŒ± Points placÃ©s: 5            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚    [VUE AR ARKIT EN DIRECT]     â”‚
â”‚                                 â”‚
â”‚  â€¢ Nuage de points dÃ©tectÃ©s     â”‚
â”‚  â€¢ SphÃ¨res vertes = arbres      â”‚
â”‚  â€¢ Plans dÃ©tectÃ©s (grille)      â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   [Bouton: ğŸŒ³ Placer Point]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ce qui s'affiche :**
- Vue camÃ©ra AR en temps rÃ©el
- HUD transparent avec :
  - Nom du point de rÃ©fÃ©rence actuel
  - Distance depuis la derniÃ¨re rÃ©fÃ©rence
  - Nombre de surfaces dÃ©tectÃ©es par ARKit
  - Nombre de points placÃ©s
- Bouton pour placer un nouveau point

---

### 3. Placement de points avec ARKit

**Fonctionnement :**

1. ARKit dÃ©tecte automatiquement les surfaces (sol)
2. L'utilisateur se dÃ©place librement
3. ARKit calcule automatiquement la position 3D de la camÃ©ra
4. Le HUD affiche la distance en temps rÃ©el
5. Quand l'utilisateur appuie sur "Placer Point" :
   - ARKit crÃ©e un `ARAnchor` Ã  l'emplacement actuel
   - Une sphÃ¨re verte 3D apparaÃ®t Ã  cet endroit
   - Le point devient la nouvelle rÃ©fÃ©rence
   - La distance se rÃ©initialise Ã  0.00m
6. L'utilisateur peut continuer Ã  placer d'autres points

**Important :** 
- Chaque nouveau point devient automatiquement la rÃ©fÃ©rence pour les mesures suivantes
- Les points restent visibles dans l'espace tant que l'app est ouverte
- ARKit garde les points ancrÃ©s mÃªme si tu bouges, tournes, ou marches autour

---

### 4. ChaÃ®nage des rÃ©fÃ©rences
```
QR Code scannÃ© (RÃ©fÃ©rence 0)
    â†“
[Marche 3.5m]
    â†“
Place Point 1 â†’ devient RÃ©fÃ©rence 1 (distance reset Ã  0m)
    â†“
[Marche 2.8m]
    â†“
Place Point 2 â†’ devient RÃ©fÃ©rence 2 (distance reset Ã  0m)
    â†“
[Marche 4.1m]
    â†“
Place Point 3 â†’ devient RÃ©fÃ©rence 3 (distance reset Ã  0m)
```

---

### 5. Affichage visuel 3D

**Dans la vue AR, afficher :**

1. **Nuage de points ARKit** : Points jaunes/blancs montrant ce qu'ARKit dÃ©tecte
2. **Plans dÃ©tectÃ©s** : Grille semi-transparente sur le sol
3. **SphÃ¨res vertes** : Une sphÃ¨re verte de ~10cm Ã  chaque point d'arbre placÃ©
4. **Labels 3D** : Au-dessus de chaque sphÃ¨re, afficher "Arbre 1", "Arbre 2", etc.
5. **Ligne de mesure** : Une ligne en 3D entre la camÃ©ra et le dernier point de rÃ©fÃ©rence

---

## ğŸ”§ ARCHITECTURE TECHNIQUE

### Structure des fichiers
```
PlantationTracker/
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ QRCodeData.swift          â†’ Structure du QR Code
â”‚   â””â”€â”€ PlantPoint.swift          â†’ Structure d'un point placÃ©
â”‚
â”œâ”€â”€ Managers/
â”‚   â”œâ”€â”€ ARManager.swift           â†’ Gestion ARKit (session, ancres, calculs)
â”‚   â””â”€â”€ QRCodeManager.swift       â†’ Scanner QR Code
â”‚
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ QRScannerView.swift       â†’ Ã‰cran scan QR Code
â”‚   â”œâ”€â”€ ARMeasureView.swift       â†’ Ã‰cran principal AR
â”‚   â””â”€â”€ HUDOverlay.swift          â†’ HUD overlay (distance, infos)
â”‚
â””â”€â”€ Utils/
    â””â”€â”€ HapticManager.swift       â†’ Vibrations
```

---

## ğŸ“Š FLUX DE L'APPLICATION

### Au dÃ©marrage

1. Lancer l'app â†’ afficher QRScannerView
2. Scanner QR Code â†’ valider JSON
3. Si valide â†’ passer Ã  ARMeasureView

### Dans ARMeasureView

1. DÃ©marrer la session ARKit
2. ARKit commence Ã  dÃ©tecter les surfaces
3. Afficher le HUD avec infos en temps rÃ©el
4. L'utilisateur se dÃ©place â†’ distance mise Ã  jour automatiquement
5. L'utilisateur appuie sur "Placer Point" :
   - Hit test au centre de l'Ã©cran
   - CrÃ©er un ARAnchor sur le plan dÃ©tectÃ©
   - Dessiner une sphÃ¨re verte Ã  cet endroit
   - Vibration + message "Point X placÃ©"
   - Ce point devient la nouvelle rÃ©fÃ©rence
   - RÃ©initialiser la distance Ã  0m
6. RÃ©pÃ©ter 5 autant de fois que nÃ©cessaire

### En se dÃ©plaÃ§ant

- ARKit suit automatiquement la position de la camÃ©ra
- Les sphÃ¨res vertes restent fixÃ©es dans l'espace rÃ©el
- Si tu reviens vers un point prÃ©cÃ©dent, la sphÃ¨re est toujours au mÃªme endroit
- Le HUD affiche toujours la distance depuis la derniÃ¨re rÃ©fÃ©rence

---

## âš™ï¸ CONFIGURATION ARKIT

### Session ARKit Ã  utiliser

**ARWorldTrackingConfiguration** avec :
- DÃ©tection de plans horizontaux (le sol)
- Pas besoin de plans verticaux
- Pas besoin de dÃ©tection d'images
- Pas besoin de dÃ©tection de personnes

### PrÃ©cision

ARKit sur iPhone donne une prÃ©cision de **1 Ã  5 centimÃ¨tres** en conditions normales.

---

## ğŸ¨ Ã‰LÃ‰MENTS VISUELS

### HUD (Overlay transparent)

Afficher en haut de l'Ã©cran :
- `ğŸ“ RÃ©f: [nom du point de rÃ©fÃ©rence]`
- `ğŸ“ Distance: [X.XX] m`
- `ğŸ¯ Surfaces: [nombre]`
- `ğŸŒ± Points placÃ©s: [nombre]`

### Marqueurs 3D

Pour chaque point placÃ©, dessiner :
- Une sphÃ¨re verte de 10cm de rayon
- Un label 3D au-dessus : "Arbre 1", "Arbre 2", etc.
- (Optionnel) Une ligne reliant le point Ã  la camÃ©ra

### Feedback utilisateur

Quand un point est placÃ© :
- Vibration haptique (succÃ¨s)
- Message toast : "âœ… Arbre X placÃ© Ã  Y.YYm"
- Animation rapide (flash ou zoom)

---

## ğŸ“ DONNÃ‰ES Ã€ STOCKER EN MÃ‰MOIRE

### Pendant l'utilisation (RAM uniquement)
```
- QR Code de rÃ©fÃ©rence :
  { id, nom, lat, lon }

- Point de rÃ©fÃ©rence actuel :
  Soit le QR Code, soit le dernier point placÃ©

- Liste des points placÃ©s :
  [
    { id: 1, nom: "Arbre 1", anchor: ARAnchor, position: (x,y,z) },
    { id: 2, nom: "Arbre 2", anchor: ARAnchor, position: (x,y,z) },
    ...
  ]

- Position actuelle de la camÃ©ra (fournie par ARKit)
Important : Quand l'app se ferme â†’ toutes ces donnÃ©es sont perdues. C'est voulu pour cette version.

âœ… CRITÃˆRES DE SUCCÃˆS
L'application doit permettre de :

âœ… Scanner un QR Code et valider son format JSON
âœ… Afficher une vue AR en temps rÃ©el
âœ… DÃ©tecter automatiquement les surfaces avec ARKit
âœ… Mesurer la distance en temps rÃ©el depuis la derniÃ¨re rÃ©fÃ©rence
âœ… Placer un point en crÃ©ant un ARAnchor
âœ… Afficher visuellement les points placÃ©s (sphÃ¨res 3D)
âœ… Utiliser chaque nouveau point comme rÃ©fÃ©rence
âœ… Garder les points ancrÃ©s dans l'espace rÃ©el
âœ… Afficher les informations dans un HUD clair
âœ… Fonctionner sans Internet ni GPS